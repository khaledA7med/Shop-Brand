<div class="modal-header py-3">
    <h4 class="modal-title">Policy Details</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
</div>
<div class="modal-body p-3">
    <div class="row">
        <div class="col-lg-4  my-2">
            <!-- Start Client Details Table -->
            <div class="card details-tables pb-3">
                <div class="card-header">
                    <h6 class="card-title text-muted text-uppercase mb-0">Client Details</h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive table-card">
                        <table class="table table-borderless mb-0">
                            <tbody id="client-information-table">
                                <tr>
                                    <th class="fw-semibold">Request No :</th>
                                    <td>{{ uiState.policyDetails.requestNo }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Client ID :</th>
                                    <td>{{ uiState.policyDetails.clientNo }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Client Name :</th>
                                    <td>{{ uiState.policyDetails.clientName }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Producer (Salesman) :</th>
                                    <td>{{ uiState.policyDetails.producer }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Policy Holder :</th>
                                    <td>{{ uiState.policyDetails.policyHolder }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Commerical No:</th>
                                    <td>{{ uiState.policyDetails.commericalNo }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- End Client Details Table -->
            <!-- Start INVOICE DETAILS Table -->
            <div class="card details-tables">
                <div class="card-header">
                    <h6 class="card-title text-muted text-uppercase mb-0">Invoice Details</h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive table-card">
                        <table class="table table-borderless mb-0">
                            <tbody id="policy-invoice-details-table-fh">
                                <tr>
                                    <th class="fw-semibold">Sum Insured :</th>
                                    <td class="input-text-right">{{ uiState.policyDetails.sumInsur | currency :
                                        'SAR' : '' }}
                                    </td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Client DN/CN No. :</th>
                                    <td class="input-text-right">{{ uiState.policyDetails.clientDNCNNo }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Net Premium :</th>
                                    <td class="input-text-right">{{ uiState.policyDetails.netPremium | currency :
                                        'SAR' : ''
                                        }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Policy Fees :</th>
                                    <td class="d-flex align-items-center justify-content-end">
                                        <span *ngIf="uiState.policyDetails.deductFees"
                                            class="text-primary input-text-right"><i class="ri-checkbox-fill"></i>
                                        </span>
                                        <span *ngIf="!uiState.policyDetails.deductFees" class="input-text-right"><i
                                                class="ri-checkbox-blank-line"></i></span>
                                        <label for="Deduct" class="mx-2 mb-0">Deduct
                                        </label>
                                        {{ uiState.policyDetails.fees | currency:
                                        'SAR' : '' }}
                                    </td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">VAT (%) :</th>
                                    <td class="input-text-right">{{ uiState.policyDetails.vatPerc }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">VAT Value :</th>
                                    <td class="input-text-right">{{ uiState.policyDetails.vatValue | currency:
                                        'SAR' : '' }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Totlal Premium :</th>
                                    <td class="input-text-right">{{ uiState.policyDetails.totalPremium | currency:
                                        'SAR' : '' }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Company Comm. DN/CN No. :</th>
                                    <td class="input-text-right">{{ uiState.policyDetails.compCommDNCNNo }}</td>
                                </tr>
                                <ng-container
                                    *ngIf="(permissions$ | async)?.includes(uiState.privileges.ChHideCompanyCommission)">
                                    <tr>
                                        <th class="fw-semibold">Commission (%) :</th>
                                        <td class="input-text-right">{{ uiState.policyDetails.compCommPerc }}</td>
                                    </tr>
                                    <tr>
                                        <th class="fw-semibold">Company Commission :</th>
                                        <td class="input-text-right">{{ uiState.policyDetails.compComm | currency:
                                            'SAR' : '' }}</td>
                                    </tr>
                                    <tr>
                                        <th class="fw-semibold">Commission VAT :</th>
                                        <td class="input-text-right">{{ uiState.policyDetails.compCommVAT |
                                            currency:
                                            'SAR' : '' }}</td>
                                    </tr>
                                    <tr>
                                        <th class="fw-semibold">Total Comp. Comm. :</th>
                                        <td class="input-text-right">{{ uiState.policyDetails.totalCompComm |
                                            currency:
                                            'SAR' : '' }}</td>
                                    </tr>
                                    <tr>
                                        <th class="fw-semibold">Total Policy Net Premium :</th>
                                        <td class="input-text-right">{{ uiState.policyDetails.policyNetAmount |
                                            currency:
                                            'SAR' : '' }}</td>
                                    </tr>
                                    <tr *ngIf="uiState.policyDetails.endorsType ==='Policy'">
                                        <th class="fw-semibold">Number Of Renewals :</th>
                                        <td class="input-text-right">{{ uiState.policyDetails.renewalCountPerClass}}
                                        </td>
                                    </tr>
                                </ng-container>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- End INVOICE DETAILS Table -->
        </div>

        <div class="col-lg-4  my-2">
            <!-- Start Issue Type Table -->
            <div class="card details-tables">
                <div class="card-header">
                    <h6 class="card-title text-muted text-uppercase mb-0">Issue Type</h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive table-card">
                        <table class="table table-borderless mb-0">
                            <tbody id="policy-issue-type-table-fh">
                                <tr>
                                    <th class="fw-semibold">A/C No :</th>
                                    <td>{{ uiState.policyDetails.accNo }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Policy No :</th>
                                    <td>{{ uiState.policyDetails.policyNo }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Endors. Type :</th>
                                    <td>{{ uiState.policyDetails.endorsType }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Endors. No :</th>
                                    <td>{{ uiState.policyDetails.endorsNo }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Issued By :</th>
                                    <td>{{ uiState.policyDetails.insurComp }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Class of Insurance :</th>
                                    <td>{{ uiState.policyDetails.className }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Line of Business :</th>
                                    <td>{{ uiState.policyDetails.lineOfBusiness }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Minimum Dreiver Age :</th>
                                    <td>{{ uiState.policyDetails.minDriverAge }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Issue Date :</th>
                                    <td>{{ (uiState.policyDetails.issueDate != undefined) ?
                                        (uiState.policyDetails.issueDate | date:"dd MMMM,yyyy") : '-' }}
                                    </td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Inception Date :</th>
                                    <td>{{ (uiState.policyDetails.periodFrom != undefined) ?
                                        (uiState.policyDetails.periodFrom | date:"dd MMMM,yyyy") : '-' }}
                                    </td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Expiry Date :</th>
                                    <td>{{ (uiState.policyDetails.periodTo != undefined) ?
                                        (uiState.policyDetails.periodTo | date:"dd MMMM,yyyy") : '-' }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Claim DeadLine :</th>
                                    <td>{{ uiState.policyDetails.claimNoOfDays }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">CS Deadline :</th>
                                    <td>{{ uiState.policyDetails.csnoOfDays }}</td>
                                </tr>
                                <tr>
                                    <th class="fw-semibold">Remarks :</th>
                                    <td>{{ uiState.policyDetails.remarks }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- End Issue Type Table -->
        </div>

        <div class="col-lg-4  my-2">
            <!-- Start PAYMENT TERMS Table -->
            <div class="card overflow-hidden">
                <div class="card-header">
                    <h6 class="card-title text-muted text-uppercase mb-0">Payment Terms</h6>
                </div>
                <div class="card-body table-responsive table-card overflow-scroll">
                    <table class="table table-nowrap mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Payment Date</th>
                                <th>(%)</th>
                                <th>Amount</th>
                                <th>VAT Amount</th>
                                <th>Policy Fees</th>
                            </tr>
                        </thead>
                        <tbody id="payment-terms-table">
                            <ng-container *ngIf="uiState.policyDetails.paymentTermsList?.length !== 0">
                                <tr *ngFor="let item of uiState.policyDetails.paymentTermsList">
                                    <td>{{ item.payDate | date:"mediumDate" }}</td>
                                    <td>{{ item.percentage }}</td>
                                    <td class="input-text-right">{{ item.amount | currency:
                                        'SAR' : '' }}</td>
                                    <td class="input-text-right">{{ item.vatAmount | currency:
                                        'SAR' : '' }}</td>
                                    <td class="input-text-right">{{ item.policyFees | currency:
                                        'SAR' : '' }}</td>
                                </tr>
                            </ng-container>
                            <ng-container *ngIf="uiState.policyDetails.paymentTermsList?.length == 0">
                                <tr>
                                    <td colspan="100">
                                        <div class="alert my-3 alert-danger text-center" role="alert">
                                            No data found
                                        </div>
                                    </td>
                                </tr>
                            </ng-container>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- End PAYMENT TERMS Table -->

            <!-- Start PRODUCERS COMMISSIONS Table -->
            <div class="card" *ngIf="!(permissions$ | async)?.includes(uiState.privileges.ChHideProducerCommission)">
                <div class="card-header">
                    <h6 class="card-title text-muted text-uppercase mb-0">Producers Commissions</h6>
                </div>
                <div class="card-body table-responsive table-card">
                    <table class="table table-nowrap mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Producer</th>
                                <th>(%)</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <!-- policiesProducersCommissions -->
                        <tbody id="producers-commissions-table">
                            <ng-container *ngIf="uiState.policyDetails.producersCommissionsList?.length !== 0">
                                <tr *ngFor="let item of uiState.policyDetails.producersCommissionsList">
                                    <td>{{ item.producer }}</td>
                                    <td>{{ item.percentage }}</td>
                                    <td class="input-text-right">{{ item.amount | currency:
                                        'SAR' : '' }}</td>
                                </tr>
                            </ng-container>
                            <ng-container *ngIf="uiState.policyDetails.producersCommissionsList?.length == 0">
                                <tr>
                                    <td colspan="100">
                                        <div class="alert my-3 alert-danger text-center" role="alert">
                                            No data found
                                        </div>
                                    </td>
                                </tr>
                            </ng-container>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- End PRODUCERS COMMISSIONS Table -->
        </div>


        <div class="col-12  my-2">
            <!-- Start Documents  -->
            <div class="card my-3">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="card-title text-muted text-uppercase mb-0">Documents</h6>
                    <button class="btn btn-sm btn-outline-success"
                        *ngIf="(uiState.policyDetails.policyStatus=='Active')" (click)="openModal(documents)">Upload
                        Documents <i class="ri-file-upload-line"></i>
                    </button>
                </div>
                <div class="">
                    <table class="table table-responsive table-borderless align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="table-header">File Name</th>
                                <th class="table-header">Type</th>
                                <th class="table-header">Size</th>
                            </tr>
                        </thead>
                        <tbody id="policy-documents-table">
                            <ng-container *ngIf="uiState.policyDetails.documentList?.length !== 0">
                                <tr *ngFor="let item of uiState.policyDetails.documentList; let index = index">
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-sm me-2">
                                                <div
                                                    class="avatar-title bg-soft-primary {{item.colorName}} rounded fs-20">
                                                    <i *ngIf="item.type !== 'image'"
                                                        class="ri-file-{{ item.className }}"></i>
                                                    <img *ngIf="item.type == 'image'" [src]="item.data" alt="" />
                                                </div>
                                            </div>
                                            <div><button class="btn btn-link" (click)="downloadFile(item?.data!)">{{
                                                    item.name }}</button></div>
                                        </div>
                                    </td>
                                    <td>{{ (item.contentDescription?.split("/"))![0] }}</td>
                                    <td>{{ item.size }}</td>
                                </tr>
                            </ng-container>
                            <ng-container *ngIf="uiState.policyDetails.documentList?.length == 0">
                                <tr>
                                    <td colspan="100">
                                        <div class="alert my-3 alert-danger text-center" role="alert">
                                            No data found
                                        </div>
                                    </td>
                                </tr>
                            </ng-container>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- End Documents  -->
        </div>

    </div>
</div>
<div class="modal-footer pt-0">
    <div class="col-lg-12 col-md-12 col-sm-12 mt-sm-3 d-flex justify-content-between">
        <div class="col-5 d-flex justify-content-start align-items-end">
            <ng-container
                *ngIf="uiState.loadedData && !(uiState.policyDetails.reversed == 1 || uiState.policyDetails.policyStatus !== 'Active')">
                <label for="transactionDate">Transaction Date</label>
                <app-datepicker-string [required]="true" [submitted]="uiState.submitted"
                    (dateChange)="revDate($event)"></app-datepicker-string>
            </ng-container>
        </div>
        <div class="col-lg-7 col-md-12 col-sm-12 mt-sm-3 d-flex justify-content-between">
            <div class="row col-7 align-items-end">
                <div class="col-10">
                    <label class="col-form-label" for="deliveryStatus">Delivery Status</label>
                    <ng-select id="deliveryStatus" [searchable]="false" [formControl]="deliveryStatus" bindLabel="name"
                        bindValue="name" placeholder="Delivry Status">
                        <ng-option [value]="'Delivered'">Delivered</ng-option>
                        <ng-option [value]="'Undelivered'">Undelivered</ng-option>
                    </ng-select>

                </div>
                <div class="col-2">
                    <button [disabled]="deliveryStatus.invalid" class="btn btn-sm btn-info mx-2"
                        (click)="changeDeliveryStatus(deliveryStatus.getRawValue())">
                        Update
                    </button>
                </div>
            </div>
            <div class="col-4 d-flex justify-content-end align-items-end">
                <!-- <ng-container *ngIf="(permissions$ | async)?.includes(uiState.privileges.ChMakeReverseEntry)">
                    <button
                        *ngIf="uiState.loadedData && !(uiState.policyDetails.reversed == 1 || uiState.policyDetails.policyStatus !== 'Active')"
                        class="btn btn-sm btn-warning mx-2" (click)="reverse()">
                        Reverse
                    </button>
                </ng-container> -->
                <ng-container
                    *ngIf="uiState.loadedData && uiState.policyDetails.policyStatus === 'Approved by Production'">
                    <button class="btn btn-sm btn-outline-primary mx-2" (click)="reopen()">
                        Reopen
                    </button>
                </ng-container>
                <ng-container *ngIf="(permissions$ | async)?.includes(uiState.privileges.ChProdEntryApproval)">
                    <button
                        *ngIf="uiState.loadedData && !(uiState.policyDetails.done == 1 || uiState.policyDetails.reject == 1)"
                        class="btn btn-sm btn-info mx-2" (click)="changeStatus('Approve')">
                        Approve
                    </button>
                    <button
                        *ngIf="uiState.loadedData && !(uiState.policyDetails.reject == 1 || uiState.policyDetails.done == 1)"
                        class="btn btn-sm btn-secondary mx-2" (click)="changeStatus('Reject')">
                        Reject
                    </button>
                </ng-container>
                <button type="button" class="btn btn-sm btn-outline-danger mx-2" (click)="modal.close('Close click')">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>



<ng-template #documents let-modal>
    <app-sub-loader *ngIf="uiState.isLoading"></app-sub-loader>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Documents</h4>
        <button type="button" class="btn-close btn-sm" aria-label="Close" (click)="dismissModal()"></button>
    </div>
    <div class="modal-body">
        <div class="card-body">
            <div class="row mt-4">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <app-dropzone (files)="documentsList($event)" [btnEnd]="true" [isBtn]="true" [UploadedFiles]="docs"
                        #dropzone></app-dropzone>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer" *ngIf="documentsToUpload.length > 0">
        <button type="submit" class="btn btn-sm btn-success me-2" (click)="saveDocuments()">
            <i class="ri-save-2-fill"></i>
            Save
        </button>
    </div>
</ng-template>
<!-- end upload docs -->